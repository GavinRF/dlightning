<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèùÔ∏è Oasea | Rehydrate the Land</title>
    <meta name="description" content="Oasea is a serene world-building game where you transform barren islands into lush, living oases. Watch life return to the desert.">
    <meta name="keywords" content="Oasea, island game, oasis builder, nature simulation, world builder, sandbox game, relaxing game, indie game, ocean, desert island, water simulation, environment, growth, regeneration, ecology, atmospheric game">
    <meta name="author" content="Dlightning">

    <link rel="canonical" href="https://dlightning.org/games/oasea/">
    <meta name="theme-color" content="#0078b4">
    <meta name="color-scheme" content="light dark">

    <!-- PWA Support -->
    <link rel="manifest" href="/games/oasea/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Oasea">
    <link rel="apple-touch-icon" href="/games/oasea/assets/transparent_white_D-D_kkh0Kt.png">

    <!-- Open Graph -->
    <meta property="og:title" content="Oasea ‚Äî Turn Desert Islands into Living Oases">
    <meta property="og:description" content="Transform desert islands into lush, living worlds in this relaxing, atmospheric simulation game.">
    <meta property="og:image" content="https://dlightning.org/img/opengraph/Oasea-Ultimate.png">
    <meta property="og:url" content="https://dlightning.org/games/oasea/">
    <meta property="og:type" content="website">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Oasea ‚Äî Turn Desert Islands into Living Oases">
    <meta name="twitter:description" content="Watch barren islands come alive with water, plants, and light in Oasea.">
    <meta name="twitter:image" content="https://dlightning.org/games/oasea/images/oasea-preview.jpg">

   <!-- Preload critical font -->
   <link rel="preload" href="/games/oasea/font/HagridText-Regular.otf" as="font" type="font/otf" crossorigin>

   <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
   <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
   <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <script type="module" crossorigin src="/games/oasea/assets/index-DLf-cT-P.js"></script>
    <link rel="modulepreload" crossorigin href="/games/oasea/assets/three-BM-_dztD.js">
    <link rel="modulepreload" crossorigin href="/games/oasea/assets/physics-BFZyaTYb.js">
    <link rel="modulepreload" crossorigin href="/games/oasea/assets/supabase-6RHs7m4s.js">
    <link rel="stylesheet" crossorigin href="/games/oasea/assets/index-BWT07PVf.css">
  </head>

  <body>
    <!-- SVG Filter for water drop goo effect -->
    <svg class="svg-filter" style="position: absolute; width: 0; height: 0;">
      <defs>
        <filter id="goo">
          <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
          <feColorMatrix in="blur" mode="matrix" values="
            1 0 0 0 0
            0 1 0 0 0
            0 0 1 0 0
            0 0 0 18 -7
          " result="goo" />
          <feComposite in="SourceGraphic" in2="goo" operator="atop" />
        </filter>
      </defs>
    </svg>

    <!-- Main Page Loading Screen -->
    <div id="page-loading-screen">
      <div class="loading-content" id="loading-content" style="opacity: 0;">
        <!-- <h1 style="margin-bottom: 40px;">Oasea</h1> -->
        <div class="stats-loading-animation">
          <div class="drop"></div>
          <div class="drop"></div>
          <div class="drop"></div>
          <div class="collection"></div>
        </div>
        <p class="loading-text">Loading...</p>
      </div>
    </div>

    <script>
      // Wait for Hagrid-Regular font to load before showing loading screen content
      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(() => {
          document.fonts.load('bold 16vw Hagrid-Regular').then(() => {
            const loadingContent = document.getElementById('loading-content');
            if (loadingContent) {
              loadingContent.style.transition = 'opacity 0.3s ease';
              loadingContent.style.opacity = '1';
            }
          }).catch(() => {
            // Fallback: show content after short delay if font fails to load
            setTimeout(() => {
              const loadingContent = document.getElementById('loading-content');
              if (loadingContent) {
                loadingContent.style.opacity = '1';
              }
            }, 300);
          });
        });
      } else {
        // Fallback for browsers without FontFace API
        setTimeout(() => {
          const loadingContent = document.getElementById('loading-content');
          if (loadingContent) {
            loadingContent.style.opacity = '1';
          }
        }, 300);
      }
    </script>

    <div id="title-splash">
      <h1>Oasea</h1>
      <small style="color: azure;"><p>/o ä.…ôÀàsiÀê/</p></small>
      <p class="all-about">Turn a desert island into a lush&nbsp;oasis by guiding rainwater to&nbsp;the&nbsp;aquifer.</p>
        <div id="splash-buttons">
          <button id="title-play-button" class="play-btn">
            <span class="material-icons">play_arrow</span>
            Play
          </button>
        <!-- <button id="daily-button" class="daily-level-card">Daily Islet</button> -->
        <button id="instructions-button" class="secondary-btn">How to Play</button>
        </div>
    </div>
    <!-- Welcome Modal -->
    <div id="welcome-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="welcome-title" aria-describedby="welcome-description" style="display: none;">
      <div class="modal-content">
        <div class="instructions">
          <h3 id="welcome-title">Rehydrate the Island by Sculpting&nbsp;the&nbsp;Terrain</h3>
            <p id="welcome-description" class="desktop-instructions"><i>Click and drag</i>&nbsp; your mouse to raise the terrain.<br>Hold <i><strong>shift</strong></i> while dragging, or <i>right&nbsp;click</i> to lower&nbsp;the&nbsp;terrain.</p>
            <p class="desktop-instructions">Click and drag outside of the terrain to pan the camera. Use mouse wheel or pinch to zoom.</p>
            <p id="welcome-description" class="mobile-instructions">Tap and drag your finger to raise the terrain; add a second finger to&nbsp;lower&nbsp;it.</p>
            <p class="mobile-instructions">Touch outside of the terrain to pan, or pinch&nbsp;to&nbsp;zoom</p>

          <!-- Placeholder for interaction GIF -->
          <div class="gif-container">
            <img src="img/gameplay.gif" alt="Gameplay demonstration showing how to sculpt terrain and guide water" class="gameplay-gif" />
          </div>
        </div>

        <button id="play-button" class="play-btn" aria-label="Start playing the game">
          <span class="material-icons" aria-hidden="true">play_arrow</span>
          Play
        </button>
      </div>
    </div>

    <nav class="ui-controls" role="navigation" aria-label="Game controls">
            <button class="ui-control-btn" id="fullscreen" title="Toggle Fullscreen" aria-label="Toggle fullscreen mode"><span class="material-icons" aria-hidden="true">fullscreen</span></button>
      <button class="ui-control-btn" id="sound" title="Toggle Sound" aria-label="Toggle sound on or off"><span class="material-icons" aria-hidden="true">&#xe050;</span></button>
      <button class="ui-control-btn" id="leaderboard-btn" title="Leaderboard" aria-label="View leaderboard"><span class="material-icons" aria-hidden="true">leaderboard</span></button>
      <!-- <button class="ui-control-btn" id="reset" title="Reset Level"><span class="material-icons">&#xe042;</span></button> -->
    </nav>

    <!-- Level Story Overlay (shown during transitions) -->
    <div id="level-story-overlay" style="display: none;">
      <p id="level-story-text"></p>
    </div>

    <!-- Level Info -->
    <div id="level-info">
      <button id="level-name" aria-label="View level select menu. Current level: Island 1"> üèùÔ∏è </button>
    </div>

    <!-- Progress Bar UI -->
    <aside id="progress-container"
           role="progressbar"
           aria-label="Water collection progress"
           aria-valuemin="0"
           aria-valuemax="100"
           aria-valuenow="0"
           aria-valuetext="0% collected">
      <div id="progress-text" aria-hidden="true">0%</div>
      <div id="goal-marker" aria-hidden="true"></div>
      <div id="progress-fill" aria-hidden="true"></div>
    </aside>

    <!-- Play Again Button (Daily Levels Only) -->
    <button id="replay-daily-btn" style="display: none;" aria-label="Play this daily level again">
      <span class="material-icons" aria-hidden="true">replay</span>
      Play&nbsp;Again
    </button>

    <button id="next-level-btn" style="display: none;" aria-label="Continue to next island">
      <span class="material-icons" aria-hidden="true">arrow_forward</span>
      Next&nbsp;Island
    </button>

    <!-- Simple Play Overlay for subsequent levels -->
    <div id="simple-play-overlay" style="display: none;">
      <button id="simple-play-button" class="play-btn">
        <span class="material-icons">play_arrow</span>
        Play
      </button>
    </div>

    <!-- Player Name Prompt Modal (First Time) -->
    <div id="name-prompt-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="name-prompt-title" aria-describedby="name-prompt-description" style="display: none;">
      <div class="modal-content score-content">
        <h2 id="name-prompt-title">Welcome, Island Conservator!</h2>
        <p id="name-prompt-description" style="text-align: center; margin-bottom: 20px;">Enter a screen-name to track your scores</p>

        <div class="name-input-container">
          <label for="player-name-input" class="sr-only">Your player name (2-20 characters)</label>
          <input
            type="text"
            id="player-name-input"
            name="playerName"
            placeholder="Your name"
            minlength="2"
            maxlength="20"
            required
            aria-required="true"
            aria-label="Enter your player name"
            autocomplete="username"
          />
        </div>

        <button id="save-name-btn" class="play-btn" aria-label="Save name and continue">
          <span class="material-icons" aria-hidden="true">check</span>
          Continue
        </button>
      </div>
    </div>

    <!-- Score Breakdown Modal -->
    <div id="score-modal" role="dialog" aria-modal="true" aria-labelledby="score-modal-title" style="display: none;">
      <div class="modal-content score-content">

          <!-- <h2 id="score-modal-title" class="sr-only">Level Complete - Score Breakdown</h2> -->

          <!-- <div class="player-name-display">
            <label for="score-player-name" class="sr-only">Your player name</label>
            <input
              type="text"
              id="score-player-name"
              name="playerName"
              maxlength="20"
              aria-label="Your player name"
              autocomplete="username"
            />
          </div> -->

          <div class="score-stats" role="region" aria-label="Level statistics">
            <div class="stat-item">
              <span class="material-icons" aria-hidden="true">schedule</span>
              <span id="completion-time" aria-label="Completion time">0:00</span>
            </div>
            <div class="stat-item">
              <span class="material-icons" aria-hidden="true">water_drop</span>
              <span id="water-collected" aria-label="Water collected">0%</span>
            </div>
            <div class="stat-item">
              <span class="material-icons" aria-hidden="true">touch_app</span>
              <span id="terrain-edits" aria-label="Terrain edits">0</span>
            </div>
          </div>

        <div id="score-breakdown">
          <div class="score-row">
            <span class="score-label">Base Points:</span>
            <span class="score-value" id="score-base">0</span>
          </div>
          <div class="score-row">
            <span class="score-label">Collection Bonus:</span>
            <span class="score-value" id="score-bonus">0</span>
          </div>
          <div class="score-row">
            <span class="score-label">Time Bonus:</span>
            <span class="score-value" id="score-time">0</span>
          </div>
          <div class="score-row total">
            <span class="score-label">Level Score:</span>
            <span class="score-value" id="score-total">0</span>
          </div>
          <div class="score-row career-total">
            <span class="score-label">Career Total:</span>
            <span class="score-value" id="career-total">0</span>
          </div>
          <div id="personal-best-badge" style="display: none;">
            <span class="material-icons">star</span>
            New Personal Best!
          </div>
        </div>

        <button id="close-score" class="play-btn" aria-label="Close score modal">
          <span class="material-icons" aria-hidden="true">close</span>
          Close
        </button>
      </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="leaderboard-modal-title" style="display: none;">
      <div class="modal-content leaderboard-content">
        <h2 id="leaderboard-modal-title" class="sr-only">Leaderboard and Statistics</h2>

        <div class="leaderboard-tabs" role="tablist" aria-label="Leaderboard sections">
          <button class="tab-btn active" role="tab" aria-selected="true" aria-controls="leaderboard-leaderboard" data-tab="leaderboard">Leaderboard</button>
          <button class="tab-btn" role="tab" aria-selected="false" aria-controls="leaderboard-stats" data-tab="stats">My Stats</button>
          <button class="tab-btn" role="tab" aria-selected="false" aria-controls="leaderboard-credits" data-tab="credits">Credits</button>
        </div>

        <div id="leaderboard-leaderboard" class="leaderboard-tab-content" role="tabpanel" aria-labelledby="tab-leaderboard">
          <!-- Level Selector -->
          <div class="leaderboard-filters">
            <div class="filter-row">
              <label for="level-filter" class="sr-only">Filter leaderboard by level</label>
              <select id="level-filter" class="level-select" aria-label="Select level to view leaderboard">
                <option value="999">Daily Level</option>
                <option value="all">All Levels</option>
                <!-- Level options populated dynamically from levels.js -->
              </select>
              <div id="daily-countdown" class="daily-countdown" style="display: none;">
                <span class="countdown-label">Next daily:</span>
                <span id="countdown-timer" class="countdown-timer">--:--:--</span>
              </div>
            </div>

            <!-- Time Period Filters -->
            <div class="filter-row">
              <!-- <label class="filter-label">Period:</label> -->
              <div class="time-period-filters">
                <button class="period-btn active" data-period="today">Today</button>
                <button class="period-btn" data-period="month">This Month</button>
                <button class="period-btn" data-period="alltime">All Time</button>
              </div>
            </div>
          </div>

          <!-- Your Rank Banner -->
          <div id="your-rank-banner" class="your-rank-banner" style="display: none;">
            <div class="rank-info">
              <span class="rank-label">Your Rank:</span>
              <span id="player-rank" class="rank-value">#--</span>
            </div>
            <div class="best-score-info">
              <span class="best-label">Your Best:</span>
              <span id="player-best-score" class="best-value">--</span>
            </div>
          </div>

          <!-- Loading Animation -->
          <div class="stats-loading-animation" id="leaderboard-loading">
            <div class="drop"></div>
            <div class="drop"></div>
            <div class="drop"></div>
            <div class="collection"></div>
          </div>

          <!-- Leaderboard List -->
          <div class="leaderboard-list" id="leaderboard-scores" style="display: none;">
            <!-- Populated by JavaScript -->
            <!-- Show More button appended dynamically after scores -->
          </div>
        </div>

        <div id="leaderboard-stats" class="leaderboard-tab-content" style="display: none;">
          <div class="stats-loading-animation" id="stats-loading">
            <div class="drop"></div>
            <div class="drop"></div>
            <div class="drop"></div>
            <div class="collection"></div>
          </div>
          <div class="stats-player-header" id="stats-player-header" style="display: none;">
            <h3 id="stats-player-name">Player</h3>
          </div>
          <!-- Achievements Section -->
          <div class="stats-grid leaderboard-list" id="stats-content" style="display: none;">
            <div id="stats-achievements-section" style="display: none;">
              <div class="achievements-container" id="stats-achievements-list">
                <!-- Populated by JavaScript -->
              </div>
            </div>

            <div class="stat-card">
              <h3 id="total-score-stat">0</h3>
              <p>Total Score</p>
            </div>
            <div class="stat-card">
              <h3 id="best-single-stat">0</h3>
              <p>Best Single Run</p>
            </div>
            <div class="stat-card">
              <h3 id="levels-completed-stat">0</h3>
              <p>Islands Completed</p>
            </div>
            <div class="stat-card">
              <h3 id="favorite-island-stat">‚Äî</h3>
              <p>Favorite Island</p>
            </div>
            <div class="stat-card">
              <h3 id="total-time-stat">0:00</h3>
              <p>Total Play Time</p>
            </div>
            <div class="stat-card">
              <h3 id="daily-levels-played-stat">‚Äî</h3>
              <p>Daily Levels Played</p>
            </div>
            <div class="stat-card">
              <h3 id="avg-score-stat">0</h3>
              <p>Average Score</p>
            </div>
            <div class="stat-card">
              <h3 id="avg-water-stat">0%</h3>
              <p>Avg Water Saved</p>
            </div>
          </div>
        </div>

        <div id="leaderboard-credits" class="leaderboard-tab-content" style="display: none;">
          <div class="credits-content credits-section leaderboard-list">
          <h2>Water is Life.</h2>
          <h4>Special Thanks to Our Sponsors</h4>
          <div class="sponsors">
            <div class="sponsor-item">
              <a href="https://www.watershed-alliance.org" target="_blank">
              <img src="img/earthworks.png" alt="Earthworkers Ultd">
              </a>
              <a href="https://www.watershed-alliance.org" target="_blank">Earthworkers Ultd.</a>
            </div>
            <div class="sponsor-item">
              <a href="https://www.watershed-alliance.org" target="_blank">
              <img src="img/watershed-al.png" alt="Watershed Alliance">
              </a>
              <a href="https://www.watershed-alliance.org" target="_blank">Watershed Alliance</a>
            </div>
            <div class="sponsor-item">
              <a href="https://oceanprotectors.com" target="_blank">
              <img src="img/ocean-protectors.png" alt="Ocean Protectors">
              </a>
              <a href="https://oceanprotectors.com" target="_blank">Ocean Protectors</a>
            </div>
          </div>

          <h5>Typeface</h5>
          <ul>
            <li>Hagrid Grotesque by <a href="https://www.zetafonts.com/collection" target="_blank">Cosimo Lorenzo Pancini</a></li>
          </ul>

          <h5>3D Models</h5>
          <ul>
            <li>Shark, Whale, Manta Ray, Fish, Dolphin, & Grass by <a href="https://quaternius.com/" target="_blank">Quaternius</a></li>
            <li>Sailboat + Bismarck, Lady, Olive, and Ivory Cane Palms by <a href="https://poly.pizza/u/Poly%20by%20Google" target="_blank">Google Poly</a></li>
            <li>Palm Tree by <a href="https://sketchfab.com/KrazzyElf" target="_blank">Krazzy Elf</a></li>
            <li>Container Ship by <a href="https://www.alexsafayan.com/" target="_blank">Alex Safayan</a></li>
            <li>Mayan Temple by <a href="https://poly.pizza/u/Steve%20Atkins" target="_blank">Steve Atkins</a></li>
            <li>Seagulls by <a href="https://www.youtube.com/channel/UCzP-KJIwS1Shjt7H2KpokEw" target="_blank">Vicente Betoret</a></li>
            <li>Whale Shark by <a href="https://sketchfab.com/kenchoo" target="_blank">Ken Choo</a></li>
            <li>Sail-fish by <a href="https://sketchfab.com/larycim" target="_blank">Lary</a></li>
            <li>Green Sea Turtle by <a href="https://linktr.ee/lucasBS8" target="_blank">Lucas B.</a></li>
            <li>Firefly Squid by <a href="https://misaooo.artstation.com/" target="_blank">Kristina Sergeeva</a></li>
          </ul>

          <h5>SFX</h5>
          <ul>
            <li>Ocean Waves by <a href="https://freesound.org/people/richwise/" target="_blank">richwise</a></li>
            <li>Thunderstorm, Jungle, Water Drops & gameplay by <a href="https://mixkit.co" target="_blank">mixkit</a></li>
            <li>Transition woosh by <a href="https://freesound.org/people/newagesoup/" target="_blank">newagesoup</a></li>
          </ul>
          <br><br>
          <h3>A game by <a href="https://dlightning.org"><i>Dlightning‚ö°Ô∏è</i></a></h3>
          </div>
        </div>

        <button id="close-leaderboard" class="close-modal-btn">
          <span class="material-icons">close</span>
          Close
        </button>
      </div>
    </div>

    <!-- Player Profile Modal -->
    <div id="player-profile-modal" class="modal" style="display: none;">
      <div class="modal-content leaderboard-content">
        <div class="player-profile-header">
          <h2 id="profile-player-name">Player</h2>
          <p id="profile-member-since" class="profile-subtitle">Member since</p>
        </div>

        <!-- Player Stats Grid -->
        <div class="stats-loading-animation" id="profile-loading">
          <div class="drop"></div>
          <div class="drop"></div>
          <div class="drop"></div>
          <div class="collection"></div>
        </div>

        <div class="leaderboard-list">
        <!-- Achievements Section -->
        <div id="profile-achievements-section" style="display: none;">
          <div class="achievements-container" id="profile-achievements-list">
            <!-- Populated by JavaScript -->
          </div>
        </div>

        <div class="stats-grid leaderboard-list" id="profile-stats-content" style="display: none;">
          <div class="stat-card">
            <h3 id="profile-total-score">0</h3>
            <p>Total Score</p>
          </div>
          <div class="stat-card">
            <h3 id="profile-best-single">0</h3>
            <p>Best Single Run</p>
          </div>
          <div class="stat-card">
            <h3 id="profile-levels-completed">0</h3>
            <p>Islands Completed</p>
          </div>
          <div class="stat-card">
            <h3 id="profile-games-played">0</h3>
            <p>Games Played</p>
          </div>
          <div class="stat-card">
            <h3 id="profile-total-time">0:00</h3>
            <p>Total Play Time</p>
          </div>
          <div class="stat-card">
            <h3 id="profile-avg-score">0</h3>
            <p>Average Score</p>
          </div>
        </div>

        <!-- Recent Scores -->
        <div class="profile-section" id="profile-recent-scores" style="display: none;">
          <h3>Recent Scores</h3>
          <div id="profile-scores-list">
            <!-- Populated by JavaScript -->
          </div>
        </div>
        </div>

        <button id="close-player-profile" class="close-modal-btn">
          <span class="material-icons">close</span>
          Close
        </button>
      </div>
    </div>

    <!-- Level Select Modal -->
    <div id="level-select-modal" class="modal hidden">
      <div class="modal-content">
        <h2>Island Select <span class="material-symbols-outlined">
mountain_steam
</span></h2>

        <div id="level-grid">
          <!-- Levels will be populated by JavaScript -->
        </div>

        <button id="close-level-select" class="close-modal-btn">
          <span class="material-icons">close</span>
          Close
        </button>
      </div>
    </div>

    <!-- Share Score Modal (Daily Levels) -->
    <div id="share-modal" class="modal hidden">
      <div class="modal-content share-content">
        <h2>Share Your Score</h2>

        <div id="share-score-summary">
          <div class="share-level-name"></div>
          <div class="share-score-value"></div>
          <div class="share-time-value"></div>
          <div class="share-rank-row" style="display: none;">
            <div class="share-rank-stat">
              <span class="share-rank-label">Rank:</span>
              <span class="share-rank-value"></span>
            </div>
            <div class="share-percentile-stat">
              <span class="share-percentile-label">Percentile:</span>
              <span class="share-percentile-value"></span>
            </div>
          </div>
          <div class="share-stats-row">
            <div class="share-stat">
              <span class="share-stat-icon">üíß</span>
              <span class="share-water-value"></span>
            </div>
            <div class="share-stat">
              <span class="share-stat-icon">‚ö°</span>
              <span class="share-efficiency-value"></span>
            </div>
          </div>
        </div>

        <div class="share-buttons">
          <button id="copy-score-btn" class="share-btn">
            <span class="material-icons">content_copy</span>
            Copy Score
          </button>

          <button id="native-share-btn" class="share-btn" style="display: none;">
            <span class="material-icons">share</span>
            Share
          </button>
        </div>

        <button id="close-share" class="close-modal-btn">
          <span class="material-icons">close</span>
          Play Another
        </button>
      </div>
    </div>

    <!-- Play Again Button (shown after credits) -->
    <div id="play-again-overlay" style="display: none; opacity: 0;">
      <button id="play-again-btn" class="play-btn">
        Play Again?
      </button>
    </div>

    <div id="bottom-logo-bar">
      <a href="https://dlightning.org" target="_blank">
        <img src="img/transparent_white_D.png" alt="Dlighting logo">
      </a>
      <!-- <a href="https://www.watershed-alliance.org" target="_blank">
        <img src="img/watershed-al.png" alt="Watershed Alliance Logo">
      </a> -->
    </div>

    <!-- END HTML -->

    <!-- Service Worker Registration -->
    <script>
      // Register service worker for PWA support
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('Service Worker registered successfully:', registration.scope);

              // Check for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;

                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New service worker available, show update notification
                    console.log('New version available! Refresh to update.');

                    // Optional: Show a toast notification to the user
                    if (window.showToast) {
                      window.showToast('Update available! Refresh to get the latest version.', 'info');
                    }
                  }
                });
              });

              // Check for updates every hour
              setInterval(() => {
                registration.update();
              }, 60 * 60 * 1000);
            })
            .catch((error) => {
              console.log('Service Worker registration failed:', error);
            });
        });

        // Handle service worker messages
        navigator.serviceWorker.addEventListener('message', (event) => {
          if (event.data && event.data.type === 'CACHE_UPDATED') {
            console.log('Cache has been updated');
          }
        });

        // Reload page when new service worker takes control
        let refreshing = false;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          if (!refreshing) {
            refreshing = true;
            window.location.reload();
          }
        });
      }

      // Install prompt handling
      let deferredPrompt;

      window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent the mini-infobar from appearing on mobile
        e.preventDefault();
        // Stash the event so it can be triggered later
        deferredPrompt = e;

        console.log('PWA install prompt available');

        // Optional: Show your own install button
        // You could create a custom "Add to Home Screen" button and show it here
      });

      window.addEventListener('appinstalled', () => {
        console.log('PWA was installed successfully');
        deferredPrompt = null;

        // Optional: Track installation with analytics
        if (window.showToast) {
          window.showToast('Oasea installed! You can now play offline.', 'success');
        }
      });
    </script>

  </body>
</html>
